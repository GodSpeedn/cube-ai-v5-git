# ğŸ” GitHub Upload Troubleshooting Guide

## Problem: Files Saved But Not Uploaded to GitHub

If your code is being saved locally but not uploaded to GitHub, follow this step-by-step troubleshooting guide.

---

## ğŸš€ Quick Diagnosis

### **Step 1: Run the Debug Tool**
```bash
# Run this comprehensive debug script:
debug_github_upload.bat
```

This will check:
- âœ… GitHub credentials in environment
- âœ… GitHub service import
- âœ… GitHub API connection
- âœ… Repository creation permissions
- âœ… Recent project files
- âœ… File manager status

### **Step 2: Test File Upload Directly**
```bash
cd backend-ai
python test_file_upload.py
```

This will:
- Create a test file
- Try to save and upload it
- Show detailed results

---

## ğŸ” Common Issues and Solutions

### **Issue 1: GitHub Service Import Failed**

**Symptoms:**
```
âš ï¸ GitHub service not available: No module named 'github_service'
```

**Solution:**
1. Check if `git-integration` folder exists
2. Verify `github_service.py` is present
3. Run the import test:
   ```bash
   cd backend-ai
   python test_github_import.py
   ```

### **Issue 2: GitHub Credentials Not Loaded**

**Symptoms:**
```
âš ï¸ GitHub not configured - code saved locally only
```

**Solution:**
1. Check `backend-ai/keys.txt` has your credentials:
   ```
   GITHUB_TOKEN=ghp_your_actual_token
   GITHUB_USERNAME=your_username
   ```
2. Restart services to reload environment variables
3. Use `start_all_safe.bat` to ensure variables are loaded

### **Issue 3: GitHub Token Invalid/Expired**

**Symptoms:**
```
âŒ GitHub API connection failed: 401
âŒ Token validation failed
```

**Solution:**
1. Generate new token at https://github.com/settings/tokens
2. Ensure token has these scopes:
   - `repo` (Full control of private repositories)
   - `workflow` (Update GitHub Action workflows)
   - `write:packages` (Upload packages to GitHub Package Registry)
3. Update `keys.txt` with new token
4. Restart services

### **Issue 4: Repository Creation Permission Denied**

**Symptoms:**
```
âŒ Repository creation failed: 403
```

**Solution:**
1. Check if you've hit GitHub's repository limit
2. Verify token has `repo` scope
3. Try creating a repository manually on GitHub to test permissions

### **Issue 5: Network/Firewall Issues**

**Symptoms:**
```
âŒ Network error: Failed to establish connection
âŒ Connection timeout
```

**Solution:**
1. Check internet connection
2. Verify no firewall blocking GitHub API (api.github.com)
3. Try accessing https://api.github.com in browser

### **Issue 6: File Manager Not Triggering Upload**

**Symptoms:**
- Code saved locally âœ…
- No GitHub upload attempt âŒ
- No "ğŸš€ STARTING GITHUB AUTO-UPLOAD" in logs

**Solution:**
1. Check if `_auto_upload_to_github` is being called
2. Verify `file_manager.save_code()` is being used
3. Check service logs for any errors

---

## ğŸ“‹ Step-by-Step Debug Process

### **1. Check Service Status**
```bash
# Verify services are running:
netstat -an | findstr ":8001"  # Online Agent Service
```

### **2. Check Environment Variables**
```bash
# In the service window, check if variables are loaded:
echo %GITHUB_TOKEN%
echo %GITHUB_USERNAME%
```

### **3. Check Service Logs**
Look for these messages in the service window:
```
âœ… GitHub service modules imported successfully
âœ… Found GitHub credentials in environment variables
ğŸ”§ Using direct GitHub API with environment credentials
ğŸš€ STARTING GITHUB AUTO-UPLOAD
```

### **4. Test Manual Upload**
```bash
cd backend-ai
python test_file_upload.py
```

### **5. Check Generated Files**
```bash
# Look for recent projects:
dir backend-ai\generated\projects /od
```

---

## ğŸ”§ Manual Testing Commands

### **Test GitHub API Directly**
```python
import requests
import os

token = os.environ.get('GITHUB_TOKEN')
headers = {'Authorization': f'token {token}'}
response = requests.get('https://api.github.com/user', headers=headers)
print(f"Status: {response.status_code}")
print(f"User: {response.json().get('login')}")
```

### **Test Repository Creation**
```python
import requests
import os

token = os.environ.get('GITHUB_TOKEN')
username = os.environ.get('GITHUB_USERNAME')
headers = {'Authorization': f'token {token}'}

repo_data = {
    'name': 'test-repo-manual',
    'description': 'Manual test repository',
    'private': True
}

response = requests.post('https://api.github.com/user/repos', 
                        headers=headers, json=repo_data)
print(f"Status: {response.status_code}")
print(f"Response: {response.text}")
```

---

## ğŸ“Š Expected Log Flow

When everything works correctly, you should see this sequence:

```
1. Service startup:
   âœ… GitHub service modules imported successfully
   âœ… Found GitHub credentials in environment variables

2. Code generation:
   ğŸ” Saving source code from coder (coder)
   ğŸ“ Task: Create a calculator - Source Code Generated by coder (coder)
   ğŸ“‚ File type: src
   ğŸ’¬ Conversation ID: manual_workflow_123

3. GitHub upload:
   ============================================================
   ğŸš€ STARTING GITHUB AUTO-UPLOAD
   ğŸ“ Project: calculator_project_abc123
   ğŸ“ Description: Create a calculator - Source Code Generated by coder
   ğŸ“‚ Directory: C:\...\generated\projects\calculator_project_abc123
   ============================================================
   âœ… Found GitHub credentials in environment variables
      Username: GodSpeedn
   ğŸ™ GitHub configuration loaded from: environment
   ğŸ”§ Using direct GitHub API with environment credentials
   ğŸ“ Creating repository: calculator-project-abc123
   âœ… Repository created: https://github.com/GodSpeedn/calculator-project-abc123
   ğŸ“¤ Uploading 3 files...
   ============================================================
   âœ… GITHUB UPLOAD SUCCESSFUL!
   ğŸ™ Repository URL: https://github.com/GodSpeedn/calculator-project-abc123
   ğŸ“Š Files uploaded: 3
   â° Upload time: 2025-01-10T14:30:45.123456
   ============================================================
```

---

## ğŸ¯ Quick Fixes

### **If Nothing Works:**
1. **Restart everything**:
   ```bash
   resolve_port_conflicts.bat
   start_all_safe.bat
   ```

2. **Check GitHub token**:
   - Go to https://github.com/settings/tokens
   - Generate new token with `repo` scope
   - Update `keys.txt`

3. **Test manually**:
   ```bash
   cd backend-ai
   python test_file_upload.py
   ```

### **If Upload Works But Files Are Wrong:**
- Check file naming in `_generate_filename()`
- Verify file content is being extracted correctly
- Check project structure in generated folder

---

## ğŸ“ Getting Help

If you're still having issues:

1. **Run the debug tool** and share the output
2. **Check service logs** for specific error messages
3. **Test with a simple workflow** (single coder agent)
4. **Verify GitHub token** works manually

**The debug tools will show you exactly where the process is failing!** ğŸ”
